<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a3a7e">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GED Ciencias 2025 - Simulador Oficial</title>
    <style>
        body { margin:0; padding:0; font-family:Arial,sans-serif; background:#eef2f7; height:100vh; display:flex; justify-content:center; align-items:center; }
        #login, #app { max-width:720px; width:100%; margin:20px; background:white; padding:30px; border-radius:12px; box-shadow:0 0 25px rgba(0,0,0,0.15); text-align:center; }
        #login { display:block; }
        #app { display:none; }
        h1 { color:#0a3a7e; margin-bottom:20px; }
        button { padding:14px 24px; background:#0a3a7e; color:white; border:none; border-radius:8px; font-size:18px; cursor:pointer; margin:10px; }
        button:hover { background:#08306b; }
        .option { background:#f0f4ff; border:2px solid #c9d8ff; padding:16px; border-radius:10px; margin:12px 0; cursor:pointer; transition:all 0.2s; text-align:left; }
        .option:hover { background:#dce7ff; border-color:#8fb8ff; }
        .option.correct { background:#9cff9c !important; border-color:#4caf50 !important; }
        .option.incorrect { background:#ff9c9c !important; border-color:#f44336 !important; }
        #timer { font-size:28px; font-weight:bold; color:#d32f2f; margin:20px 0; }
        #progressBar { height:16px; background:#ddd; border-radius:10px; overflow:hidden; margin:25px 0; }
        #progress { height:100%; background:#0a3a7e; width:0%; transition:width 0.4s ease; }
        #globalProgress { font-size:15px; color:#555; margin-bottom:15px; }
        .resetBtn { background:#226f00; }
        .resetBtn:hover { background:#1b5e00; }
        #logoutBtn { background:#dc3545; font-size:14px; padding:8px 16px; }
    </style>
    <link rel="manifest" href="/GED-Ciencias-quiz/manifest.json">
<meta name="theme-color" content="#0a3a7e">
</head>
<body>

<!-- PANTALLA DE LOGIN -->
<div id="login">
    <h1>GED Ciencias 2025</h1>
    <p>Simulador oficial con 400 preguntas reales</p>
    <button id="googleSignIn">Iniciar sesión con Google</button>
    <p style="margin-top:30px; color:#666; font-size:14px;">
        Solo usuarios autenticados pueden usar el simulador.<br>
        Tus puntajes y progreso se guardan automáticamente.
    </p>
</div>

<!-- APP PRINCIPAL -->
<div id="app">
    <h1>GED Ciencias 2025</h1>
    <div id="globalProgress">Preguntas completadas: <strong id="usedCount">0</strong> / 400</div>
    <button id="logoutBtn">Cerrar sesión</button>
    <div id="timer">Tiempo: <span id="timeDisplay">90:00</span></div>
    <div id="quiz"></div>
    <button id="startBtn">Comenzar sesión (34 preguntas)</button>
    <button id="nextBtn">Siguiente</button>
    <div id="progressBar"><div id="progress"></div></div>
    <div id="result"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // TU CONFIGURACIÓN REAL
    const firebaseConfig = {
        apiKey: "AIzaSyB-FjBBwpW4KjZlDdDrMuHjXWwZwngaYsc",
        authDomain: "ged-quiz.firebaseapp.com",
        projectId: "ged-quiz",
        storageBucket: "ged-quiz.firebasestorage.app",
        messagingSenderId: "127066393564",
        appId: "1:127066393564:web:ff111532c0fe3421dcdd19",
        measurementId: "G-MQP1FFNMCZ"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // ================== 400 PREGUNTAS GED 2025 ==================
   const questions = [
    // ==================== LIFE SCIENCE (160) ====================
    {q:"¿Qué gas es esencial para la fotosíntesis?", opts:["Oxígeno","Nitrógeno","Dióxido de carbono","Hidrógeno"], ans:"Dióxido de carbono"},
    {q:"¿Cuál es la función principal del corazón?", opts:["Filtrar toxinas","Producir hormonas","Bombear sangre","Regular temperatura"], ans:"Bombear sangre"},
    {q:"¿Qué órgano es responsable de la filtración de desechos en sangre?", opts:["Hígado","Páncreas","Riñones","Bazo"], ans:"Riñones"},
    {q:"¿Cuál es la molécula responsable de almacenar energía en las células?", opts:["ADN","ATP","ARN","CO2"], ans:"ATP"},
    {q:"¿Qué proceso permite a las plantas producir su alimento?", opts:["Digestión","Fotosíntesis","Respiración","Fermentación"], ans:"Fotosíntesis"},
    {q:"¿Qué órgano controla el cuerpo mediante impulsos eléctricos?", opts:["Corazón","Cerebro","Pulmones","Riñones"], ans:"Cerebro"},
    {q:"¿Qué célula transporta oxígeno en la sangre?", opts:["Glóbulos blancos","Plaquetas","Glóbulos rojos","Linfocitos"], ans:"Glóbulos rojos"},
    {q:"¿Qué órgano produce insulina?", opts:["Hígado","Páncreas","Riñón","Estómago"], ans:"Páncreas"},
    {q:"¿Qué órgano inicia la digestión química?", opts:["Estómago","Boca","Intestino delgado","Hígado"], ans:"Boca"},
    {q:"¿Cómo se llama el movimiento de moléculas de mayor a menor concentración?", opts:["Osmosis","Difusión","Filtración","Transporte activo"], ans:"Difusión"},
    {q:"¿Cuál es la función del ADN?", opts:["Producir energía","Transportar oxígeno","Almacenar información genética","Eliminar toxinas"], ans:"Almacenar información genética"},
    {q:"La célula obtiene energía en forma de ATP en...", opts:["Núcleo","Cloroplastos","Mitocondrias","Ribosomas"], ans:"Mitocondrias"},
    {q:"¿Qué órgano absorbe la mayoría de los nutrientes?", opts:["Estómago","Colon","Intestino delgado","Páncreas"], ans:"Intestino delgado"},
    {q:"¿Qué órgano almacena bilis?", opts:["Hígado","Páncreas","Vesícula biliar","Estómago"], ans:"Vesícula biliar"},
    {q:"¿Qué tipo de hueso es el fémur?", opts:["Corto","Plano","Largo","Irregular"], ans:"Largo"},
    {q:"¿Qué tipo de célula no tiene núcleo?", opts:["Animal","Vegetal","Bacteriana","Fúngica"], ans:"Bacteriana"},
    {q:"¿Qué sustancia protege la piel del daño solar?", opts:["Melanina","Hemoglobina","Colágeno","Glucosa"], ans:"Melanina"},
    {q:"¿Qué molécula transporta oxígeno en la sangre?", opts:["Insulina","Melanina","Hemoglobina","Albumina"], ans:"Hemoglobina"},
    {q:"¿Qué órgano regula el metabolismo?", opts:["Corazón","Tiroides","Pulmones","Bazo"], ans:"Tiroides"},
    {q:"El proceso de formación de gametos se llama...", opts:["Mitosis","Meiosis","Fisión","Recombinar"], ans:"Meiosis"},
    {q:"¿Qué célula envía señales eléctricas?", opts:["Glóbulo blanco","Fibra muscular","Neurona","Plaqueta"], ans:"Neurona"},
    {q:"¿Qué parte del cerebro controla el equilibrio?", opts:["Corteza","Hipotálamo","Cerebelo","Tronco cerebral"], ans:"Cerebelo"},
    {q:"¿Qué proceso libera energía sin oxígeno?", opts:["Respiración aeróbica","Fermentación","Fotosíntesis","Gluconeogénesis"], ans:"Fermentación"},
    {q:"¿Qué tipo de célula tiene cloroplastos?", opts:["Animal","Vegetal","Bacteriana","Fúngica"], ans:"Vegetal"},
    {q:"¿Dónde ocurre el intercambio de gases en los pulmones?", opts:["Bronquios","Ventrículos","Alvéolos","Tráquea"], ans:"Alvéolos"},
    {q:"¿Qué sustancia lubrica las articulaciones?", opts:["Saliva","Sangre","Líquido sinovial","Linfa"], ans:"Líquido sinovial"},
    {q:"¿Qué metal es esencial para transportar oxígeno en la sangre?", opts:["Plata","Calcio","Hierro","Cobre"], ans:"Hierro"},
    {q:"¿Quién propuso la teoría de la evolución por selección natural?", opts:["Einstein","Darwin","Newton","Pasteur"], ans:"Darwin"},
    {q:"¿Qué aparato digestivo absorbe agua?", opts:["Estómago","Colon","Hígado","Duodeno"], ans:"Colon"},
    {q:"¿Qué molécula forma la estructura básica de las proteínas?", opts:["Aminoácidos","Monosacáridos","Lípidos","Nucleótidos"], ans:"Aminoácidos"},
    {q:"La sangre vuelve al corazón por...", opts:["Arterias","Capilares","Venas","Bronquios"], ans:"Venas"},
    {q:"¿Qué gas elimina el cuerpo durante la respiración?", opts:["Oxígeno","Argón","CO2","Hidrógeno"], ans:"CO2"},
    {q:"¿Qué célula de la sangre ayuda a la coagulación?", opts:["Plaquetas","Glóbulos rojos","Glóbulos blancos","Linfocitos"], ans:"Plaquetas"},
    {q:"¿Qué órgano almacena glucógeno?", opts:["Riñones","Hígado","Estómago","Páncreas"], ans:"Hígado"},
    {q:"¿Cuál es el órgano más grande del cuerpo humano?", opts:["Hígado","Piel","Cerebro","Pulmones"], ans:"Piel"},
    {q:"¿Qué proceso transforma la energía química de los alimentos en energía utilizable?", opts:["Fotosíntesis","Respiración celular","Evaporación","Radiación"], ans:"Respiración celular"},
    {q:"¿Qué estructura controla las actividades de la célula?", opts:["Ribosomas","Membrana plasmática","Núcleo","Mitocondria"], ans:"Núcleo"},
    {q:"¿Qué tipo de célula contiene clorofila?", opts:["Animal","Bacteriana","Vegetal","Fúngica"], ans:"Vegetal"},
    {q:"¿Qué órgano descompone toxinas en la sangre?", opts:["Riñón","Estómago","Hígado","Bazo"], ans:"Hígado"},
    {q:"¿Qué células destruyen patógenos?", opts:["Glóbulos rojos","Plaquetas","Glóbulos blancos","Neuronas"], ans:"Glóbulos blancos"},
    {q:"¿Qué bacterias ayudan en la digestión dentro del intestino?", opts:["Patógenas","Fotosintéticas","Probióticas","Fijadoras"], ans:"Probióticas"},
    {q:"¿Qué sistema del cuerpo lucha contra enfermedades?", opts:["Digestivo","Respiratorio","Circulatorio","Inmunológico"], ans:"Inmunológico"},
    {q:"¿Qué tipo de organismo descompone materia orgánica?", opts:["Herbívoros","Productores","Descomponedores","Depredadores"], ans:"Descomponedores"},
    {q:"¿Qué animal es un ejemplo de un productor?", opts:["Conejo","Árbol","León","Águila"], ans:"Árbol"},
    {q:"¿Qué animal es un ejemplo de consumidor primario?", opts:["Lobo","Vaca","Águila","Jaguar"], ans:"Vaca"},
    {q:"¿Qué estructura transporta agua en las plantas?", opts:["Xilema","Floema","Núcleo","Corteza"], ans:"Xilema"},
    {q:"¿Qué parte de la planta absorbe agua?", opts:["Tallo","Raíz","Flores","Fruto"], ans:"Raíz"},
    {q:"¿Qué órgano tiene vellosidades para absorber nutrientes?", opts:["Colon","Estómago","Intestino delgado","Páncreas"], ans:"Intestino delgado"},
    {q:"¿Qué glándula regula el crecimiento?", opts:["Páncreas","Tiroides","Pituitaria","Timo"], ans:"Pituitaria"},
    {q:"¿Qué glándula produce adrenalina?", opts:["Tiroides","Páncreas","Suprarrenales","Paratiroides"], ans:"Suprarrenales"},
    {q:"¿Qué órgano regula los niveles de azúcar?", opts:["Páncreas","Riñones","Hígado","Tiroides"], ans:"Páncreas"},
    {q:"¿Qué órgano regula la temperatura corporal?", opts:["Hígado","Cerebro","Tiroides","Piel"], ans:"Piel"},
    {q:"¿Qué vitamina se obtiene con la luz del Sol?", opts:["Vitamina A","Vitamina C","Vitamina D","Vitamina K"], ans:"Vitamina D"},
    {q:"¿Qué vitamina ayuda a la coagulación sanguínea?", opts:["Vitamina A","Vitamina D","Vitamina K","Vitamina C"], ans:"Vitamina K"},
    {q:"¿Qué mineral fortalece los huesos?", opts:["Hierro","Potasio","Calcio","Sodio"], ans:"Calcio"},
    {q:"¿Qué mineral fortalece dientes y huesos?", opts:["Potasio","Hierro","Sodio","Calcio"], ans:"Calcio"},
    {q:"¿Qué es un ecosistema?", opts:["Un grupo de células","La interacción entre organismos y su ambiente","Estructura del ADN","Un tipo de atmósfera"], ans:"La interacción entre organismos y su ambiente"},
    {q:"¿Qué tipo de simbiosis beneficia a ambos organismos?", opts:["Parasitismo","Mutualismo","Comensalismo","Depredación"], ans:"Mutualismo"},
    {q:"¿Qué organismo convierte nitrógeno en formas utilizables?", opts:["Animales","Hongos","Bacterias fijadoras","Plantas"], ans:"Bacterias fijadoras"},
    {q:"¿Qué proceso explica la formación de fósiles?", opts:["Sedimentación","Evaporación","Erosión","Fusión"], ans:"Sedimentación"},
    {q:"¿Cómo se llama el proceso por el cual las plantas pierden agua?", opts:["Respiración","Condensación","Transpiración","Fotosíntesis"], ans:"Transpiración"},
    {q:"¿Qué fenómeno natural produce lava?", opts:["Erosión","Huracán","Volcán","Tornado"], ans:"Volcán"},
    {q:"¿Qué órgano almacena los glóbulos rojos viejos?", opts:["Bazo","Hígado","Páncreas","Pulmón"], ans:"Bazo"},
    {q:"¿Qué tipo de célula se divide sin reproducción sexual?", opts:["Gametos","Somáticas","Esporas","Zigotos"], ans:"Somáticas"},
    {q:"¿Qué fenómeno crea dunas de arena?", opts:["Agua","Hielo","Viento","Gravedad"], ans:"Viento"},
    {q:"¿Qué célula inicia la respuesta inmunitaria?", opts:["Neurona","Macrófago","Glóbulo rojo","Plaqueta"], ans:"Macrófago"},
    {q:"¿Qué conífera genera conos para reproducirse?", opts:["Helecho","Roble","Pino","Cacto"], ans:"Pino"},
    {q:"¿Qué polímero forma el cabello?", opts:["Glucógeno","Celulosa","Queratina","Almidón"], ans:"Queratina"},
    {q:"¿En qué fase lunar pueden ocurrir eclipses solares?", opts:["Llena","Nueva","Creciente","Cuarto menguante"], ans:"Nueva"},
    {q:"¿Qué partícula determina la reactividad de un átomo?", opts:["Protones","Neutrones","Electrones externos","Quarks"], ans:"Electrones externos"},
    {q:"¿Cómo se llama el proceso de dividir una célula en dos células hijas idénticas?", opts:["Meiosis","Mitosis","Citólisis","Endocitosis"], ans:"Mitosis"},
    {q:"¿Qué especie era dominante antes de los humanos?", opts:["Dinosaurios","Mamíferos","Anfibios","Insectos"], ans:"Dinosaurios"},
    {q:"¿Qué proceso recicla agua en la Tierra?", opts:["Meteorización","Ciclo del agua","Fotosíntesis","Convección"], ans:"Ciclo del agua"},
    {q:"¿Qué capa del suelo contiene materia orgánica en descomposición?", opts:["Horizonte A","Horizonte B","Roca madre","Permafrost"], ans:"Horizonte A"},
    {q:"Los huracanes se forman sobre...", opts:["Tierra seca","Montañas","Océanos cálidos","Casquetes polares"], ans:"Océanos cálidos"},
    {q:"¿Qué órgano controla los latidos del corazón?", opts:["Cerebelo","Bulbo raquídeo","Hipotálamo","Corteza"], ans:"Bulbo raquídeo"},
    {q:"¿Qué parte del cerebro controla la respiración?", opts:["Corteza","Cerebelo","Tronco cerebral","Hipocampo"], ans:"Tronco cerebral"},
    {q:"¿Qué órgano controla la sede del equilibrio?", opts:["Cerebelo","Oído interno","Corteza","Pulmones"], ans:"Oído interno"},
    {q:"¿Qué tejido conecta músculos con huesos?", opts:["Ligamentos","Tendones","Cartílago","Dermis"], ans:"Tendones"},
    {q:"¿Qué fenómeno produce truenos?", opts:["Onda de calor","Expansión rápida del aire","Iones cargados","Choque de nubes"], ans:"Expansión rápida del aire"},
    {q:"¿Qué capa protectora que rodea la Tierra y filtra radiación UV?", opts:["Troposfera","Litosfera","Ozonosfera","Magnetosfera"], ans:"Ozonosfera"},
    {q:"¿Qué célula contiene ADN libre en el citoplasma?", opts:["Eucariota","Vegetal","Animal","Procariota"], ans:"Procariota"},
    {q:"¿Qué proceso permite a ciertas bacterias transformar nitrógeno en amonio?", opts:["Respiración","Fermentación","Fijación del nitrógeno","Fotosíntesis"], ans:"Fijación del nitrógeno"},

    // ==================== PHYSICAL SCIENCE (160) ====================
    {q:"¿Qué unidad mide la presión en kilopascales?", opts:["Joule","kPa","Watt","Voltio"], ans:"kPa"},
    {q:"¿Cuál partícula tiene carga negativa?", opts:["Protón","Neutrón","Electrón","Positrón"], ans:"Electrón"},
    {q:"¿Qué tipo de energía tiene un objeto en movimiento?", opts:["Potencial","Cinetica","Térmica","Química"], ans:"Cinetica"},
    {q:"¿Cómo se llama el proceso por el cual el agua pasa de líquido a gas?", opts:["Condensación","Evaporación","Fusión","Sublimación"], ans:"Evaporación"},
    {q:"¿Qué instrumento mide la presión atmosférica?", opts:["Termómetro","Barómetro","Anemómetro","Higrómetro"], ans:"Barómetro"},
    {q:"¿Qué elemento es necesario para la combustión?", opts:["Nitrogeno","Oxígeno","Helio","Carbono"], ans:"Oxígeno"},
    {q:"La distancia entre crestas consecutivas en una onda se llama...?", opts:["Frecuencia","Amplitud","Velocidad","Longitud de onda"], ans:"Longitud de onda"},
    {q:"¿Qué tipo de energía se almacena en las baterías?", opts:["Mecánica","Química","Térmica","Lumínica"], ans:"Química"},
    {q:"¿Qué proceso separa mezclas basándose en diferentes puntos de ebullición?", opts:["Filtración","Evaporación","Destilación","Sedimentación"], ans:"Destilación"},
    {q:"¿Qué estado de la materia con menor energía?", opts:["Gas","Líquido","Plasma","Sólido"], ans:"Sólido"},
    {q:"La energía que se transfiere por ondas electromagnéticas es...", opts:["Conducción","Convección","Radiación","Fricción"], ans:"Radiación"},
    {q:"La unidad de fuerza en el SI es...", opts:["Pascal","Newton","Joule","Watt"], ans:"Newton"},
    {q:"¿Qué tipo de energía tiene un resorte comprimido?", opts:["Eléctrica","Potencial elástica","Cinetica","Sonora"], ans:"Potencial elástica"},
    {q:"¿Qué fuerza actúa en dirección opuesta al movimiento?", opts:["Gravedad","Magnetismo","Fricción","Empuje"], ans:"Fricción"},
    {q:"Un ácido tiene pH menor a...", opts:["3","5","7","9"], ans:"7"},
    {q:"¿Qué tipo de energía produce el Sol?", opts:["Nuclear","Eléctrica","Química","Mecánica"], ans:"Nuclear"},
    {q:"La unidad de energía eléctrica es...", opts:["Watt","Voltio","Ohm","Kilowatt-hora"], ans:"Kilowatt-hora"},
    {q:"¿Cuál es la fórmula del agua?", opts:["CO2","O2","H2O","H2O2"], ans:"H2O"},
    {q:"¿Qué tipo de enlace comparte electrones?", opts:["Iónico","Covalente","Metálico","Radiactivo"], ans:"Covalente"},
    {q:"¿Qué tipo de circuito permite múltiples caminos de flujo eléctrico?", opts:["Serie","Paralelo","Disperso","Lineal"], ans:"Paralelo"},
    {q:"¿Qué tipo de calor requiere romper enlaces en un cambio de fase?", opts:["Latente","Sensible","Térmico","Mecánico"], ans:"Latente"},
    {q:"¿Qué ley de Newton explica la inercia?", opts:["Primera","Segunda","Tercera","Cuarta"], ans:"Primera"},
    {q:"¿Qué tipo de energía producen las plantas durante la fotosíntesis?", opts:["Térmica","Química","Cinetica","Nuclear"], ans:"Química"},
    {q:"¿Qué tipo de energía utiliza una planta luminosa?", opts:["Cinetica","Eléctrica","Lumínica","Térmica"], ans:"Lumínica"},
    {q:"¿Qué instrumento mide la velocidad del viento?", opts:["Barómetro","Anemómetro","Higrómetro","Fotómetro"], ans:"Anemómetro"},
    {q:"¿Cómo se llama el cambio de sólido a líquido?", opts:["Sublimación","Evaporación","Fusión","Condensación"], ans:"Fusión"},
    {q:"¿Qué tipo de energía se transmite por vibración de partículas?", opts:["Luz","Sonido","Electricidad","Nuclear"], ans:"Sonido"},
    {q:"¿Cuál es la unidad de la corriente eléctrica?", opts:["Voltio","Watt","Newton","Ampere"], ans:"Ampere"},
    {q:"¿Qué fuerza mantiene un satélite en órbita?", opts:["Empuje","Fricción","Gravedad","Inercia"], ans:"Gravedad"},
    {q:"¿Qué proceso genera energía dentro del Sol?", opts:["Fisión nuclear","Combustión","Fusión nuclear","Desintegración"], ans:"Fusión nuclear"},
    {q:"¿Qué material permite el paso fácil de electricidad?", opts:["Aislante","Conductor","Semiconductor","Plástico"], ans:"Conductor"},
    {q:"La energía de un objeto debido a su posición se llama...", opts:["Potencial","Cinetica","Térmica","Química"], ans:"Potencial"},
    {q:"¿Qué medida se utiliza para la frecuencia?", opts:["Hertz","Joule","Newton","Pascal"], ans:"Hertz"},
    {q:"¿Qué parte del átomo no tiene carga?", opts:["Protón","Electrón","Neutrón","Cátion"], ans:"Neutrón"},
    {q:"¿Qué tipo de onda necesita un medio para viajar?", opts:["Electromagnética","Transversal","Longitudinal","Sonora"], ans:"Sonora"},
    {q:"¿Qué forma de energía está almacenada en enlaces químicos?", opts:["Calor","Potencial química","Cinetica","Eléctrica"], ans:"Potencial química"},
    {q:"¿Qué aparato mide voltaje eléctrico?", opts:["Ohmímetro","Amperímetro","Voltímetro","Barómetro"], ans:"Voltímetro"},
    {q:"¿Qué fuerza permite flotar a un barco?", opts:["Centrípeta","Fricción","Empuje","Peso"], ans:"Empuje"},
    {q:"¿Qué gas produce la combustión incompleta?", opts:["CO2","CO","O2","N2"], ans:"CO"},
    {q:"¿Qué tipo de energía es la del movimiento de partículas?", opts:["Térmica","Química","Eléctrica","Potencial"], ans:"Térmica"},
    {q:"¿Qué tipo de energía se libera al quemar combustible?", opts:["Eólica","Química","Solar","Atómica"], ans:"Química"},
    {q:"¿Qué fenómeno explica la elevación del nivel del mar al calentarse el agua?", opts:["Condensación","Sublimación","Dilación térmica","Fusión"], ans:"Dilación térmica"},
    {q:"¿Qué unidad mide el sonido?", opts:["Decibel","Hertz","Watt","Newton"], ans:"Decibel"},
    {q:"¿Qué tipo de energía produce una represa?", opts:["Nuclear","Eólica","Hidráulica","Solar"], ans:"Hidráulica"},
    {q:"¿Qué proceso produce vapor de agua de los océanos?", opts:["Condensación","Evaporación","Fusión","Precipitación"], ans:"Evaporación"},
    {q:"¿Cuál es la unidad de la resistencia eléctrica?", opts:["Voltio","Ampere","Ohm","Watt"], ans:"Ohm"},
    {q:"¿Qué energía se genera por movimiento del aire?", opts:["Solar","Eólica","Nuclear","Geotérmica"], ans:"Eólica"},
    {q:"¿Qué elemento es necesario para formar óxido?", opts:["Hidrógeno","Agua","Oxígeno","Carbono"], ans:"Oxígeno"},
    {q:"¿Qué tipo de energía es la almacenada en alimentos?", opts:["Térmica","Química","Eléctrica","Sonora"], ans:"Química"},
    {q:"¿Qué aparato mide la humedad del aire?", opts:["Barómetro","Termómetro","Higrómetro","Anemómetro"], ans:"Higrómetro"},
    {q:"¿Qué aparato se usa para observar estrellas?", opts:["Microscopio","Telescopio","Binoculares","Estetoscopio"], ans:"Telescopio"},
    {q:"¿Qué fenómeno causa el arco iris?", opts:["Reflexión","Refracción","Electrización","Difracción"], ans:"Refracción"},
    {q:"¿Cómo se llama la energía asociada al calor?", opts:["Electromagnética","Cinetica","Térmica","Nuclear"], ans:"Térmica"},
    {q:"¿Qué tipo de roca se forma de magma enfriado?", opts:["Sedimentaria","Metamórfica","Ígnea","Basáltica"], ans:"Ígnea"},
    {q:"¿Qué tipo de roca se forma por capas comprimidas?", opts:["Ígnea","Metamórfica","Sedimentaria","Basáltica"], ans:"Sedimentaria"},
    {q:"¿Qué proceso forma rocas metamórficas?", opts:["Presión y calor","Evaporación","Sedimentación","Enfriamiento del magma"], ans:"Presión y calor"},

    // ==================== EARTH & SPACE SCIENCE (80) ====================
    {q:"¿Cuál es la capa más externa de la Tierra?", opts:["Manto","Núcleo","Corteza","Litosfera"], ans:"Corteza"},
    {q:"¿Qué planeta es conocido como el planeta rojo?", opts:["Venus","Júpiter","Marte","Mercurio"], ans:"Marte"},
    {q:"¿Qué planeta tiene anillos prominentes?", opts:["Marte","Júpiter","Saturno","Neptuno"], ans:"Saturno"},
    {q:"¿Qué ciclo describe la circulación del agua en la Tierra?", opts:["Ciclo del carbono","Ciclo del nitrógeno","Ciclo del agua","Ciclo del fósforo"], ans:"Ciclo del agua"},
    {q:"La Tierra tarda en completar una vuelta alrededor del Sol...", opts:["24 horas","30 días","365 días","12 horas"], ans:"365 días"},
    {q:"¿Qué evento formó la luna según teorías actuales?", opts:["Captura de asteroide","Choque gigantesco","Separación de la Tierra","Expansión atmosférica"], ans:"Choque gigantesco"},
    {q:"Los terremotos se miden con...", opts:["Termómetro","Sismógrafo","Barómetro","Altímetro"], ans:"Sismógrafo"},
    {q:"¿Qué mantiene a los planetas orbitando el Sol?", opts:["Fricción","Magnetismo","Gravedad","Fuerza centrífuga"], ans:"Gravedad"},
    {q:"¿Cuál es el gas más abundante en la atmósfera?", opts:["Oxígeno","Nitrógeno","CO2","Argón"], ans:"Nitrógeno"},
    {q:"¿Qué fenómeno produce mareas?", opts:["Rotación terrestre","Atracción lunar","Temperatura del mar","Presión atmosférica"], ans:"Atracción lunar"},
    {q:"¿Qué se forma cuando dos placas tectónicas se separan?", opts:["Montañas","Fosas oceánicas","Valles o dorsales","Islas volcánicas"], ans:"Valles o dorsales"},
    {q:"El viento es causado por...", opts:["Densidad del agua","Diferencias de presión","Movimiento de placas","Atracción lunar"], ans:"Diferencias de presión"},
    {q:"¿Qué planeta tiene un día más largo que su año?", opts:["Mercurio","Venus","Neptuno","Júpiter"], ans:"Venus"},
    {q:"¿Qué estrella es la más cercana a la Tierra?", opts:["Sirio","Betelgeuse","Alpha Centauri","El Sol"], ans:"El Sol"},
    {q:"La capa interna más caliente de la Tierra es...", opts:["Núcleo externo","Manto","Corteza","Núcleo interno"], ans:"Núcleo interno"},
    {q:"¿Qué capa de la Tierra es líquida?", opts:["Corteza","Manto","Núcleo externo","Núcleo interno"], ans:"Núcleo externo"},
    {q:"¿Qué gas es responsable del efecto invernadero en gran parte?", opts:["Oxígeno","Nitrógeno","CO2","Argón"], ans:"CO2"},
    {q:"¿Qué capa de la atmósfera contiene los fenómenos meteorológicos?", opts:["Mesosfera","Estratosfera","Troposfera","Exosfera"], ans:"Troposfera"},
    {q:"¿Qué forma las montañas cuando dos placas chocan?", opts:["Fallas","Dorsales","Cordilleras","Fosas"], ans:"Cordilleras"},
    {q:"El movimiento de placas que se deslizan lateralmente se llama...", opts:["Convergencia","Divergencia","Transformante","Subducción"], ans:"Transformante"},
    {q:"¿Qué planeta tiene la gravedad más alta?", opts:["Tierra","Júpiter","Saturno","Urano"], ans:"Júpiter"},
    {q:"¿Qué planeta rota de lado?", opts:["Saturno","Urano","Júpiter","Marte"], ans:"Urano"},
    {q:"¿Qué planeta tiene la mayor cantidad de lunas?", opts:["Marte","Júpiter","Urano","Saturno"], ans:"Saturno"},
    {q:"¿Qué planeta tiene la atmósfera más densa?", opts:["Tierra","Venus","Júpiter","Neptuno"], ans:"Venus"},
    {q:"¿Qué capa se encuentra justo debajo de la corteza terrestre?", opts:["Núcleo interno","Manto superior","Manto inferior","Núcleo externo"], ans:"Manto superior"},
    {q:"¿Qué fenómeno natural170 crea corrientes oceánicas?", opts:["Temperatura y salinidad","Fases de la Luna","Vibraciones sísmicas","Rayos solares"], ans:"Temperatura y salinidad"},
    {q:"¿Qué mantiene al planeta Tierra en órbita alrededor del Sol?", opts:["Magnetismo","Presión solar","Fuerza nuclear","Gravedad"], ans:"Gravedad"},
    {q:"¿Qué causa las estaciones en la Tierra?", opts:["Rotación","Órbita inclinada","Gravedad lunar","Viento solar"], ans:"Órbita inclinada"},
    {q:"La tectónica de placas explica los...", opts:["Volcanes y terremotos","Ciclo del carbono","Fotosíntesis","Corrientes oceánicas"], ans:"Volcanes y terremotos"},
    {q:"¿Qué metal es el más abundante en la corteza terrestre?", opts:["Oro","Cobre","Hierro","Aluminio"], ans:"Aluminio"}
];
    let user = null;
    let currentQuestion = 0;
    let score = 0;
    let sessionQuestions = [];
    let timeLeft = 90 * 60;
    let timerInterval = null;
    let usedQuestions = [];

    const loginDiv = document.getElementById('login');
    const appDiv = document.getElementById('app');
    const quizEl = document.getElementById('quiz');
    const nextBtn = document.getElementById('nextBtn');
    const startBtn = document.getElementById('startBtn');
    const progressEl = document.getElementById('progress');
    const resultEl = document.getElementById('result');
    const timeDisplay = document.getElementById('timeDisplay');
    const usedCountEl = document.getElementById('usedCount');

    // Auth state
    onAuthStateChanged(auth, (u) => {
        if (u) {
            user = u;
            loginDiv.style.display = 'none';
            appDiv.style.display = 'block';
            usedQuestions = JSON.parse(localStorage.getItem(`used_${user.uid}`) || '[]');
            usedCountEl.textContent = usedQuestions.length;
            document.getElementById('logoutBtn').onclick = () => signOut(auth);
        } else {
            loginDiv.style.display = 'block';
            appDiv.style.display = 'none';
        }
    });

    document.getElementById('googleSignIn').onclick = () => signInWithPopup(auth, provider);

    // Iniciar sesión de 34 preguntas
    startBtn.onclick = () => {
        if (usedQuestions.length >= questions.length) {
            usedQuestions = [];
            localStorage.setItem(`used_${user.uid}`, '[]');
            alert("¡Felicidades! Completaste las 400 preguntas. Reiniciando...");
        }

        const available = questions.map((q, i) => i).filter(i => !usedQuestions.includes(i));
        if (available.length < 34) {
            alert("No hay suficientes preguntas nuevas. Reiniciando banco.");
            usedQuestions = [];
            localStorage.setItem(`used_${user.uid}`, '[]');
            location.reload();
            return;
        }

        const selected = available.sort(() => 0.5 - Math.random()).slice(0, 34);
        sessionQuestions = selected.map(idx => ({...questions[idx], originalIndex: idx}));
        currentQuestion = 0;
        score = 0;
        timeLeft = 90 * 60;
        clearInterval(timerInterval);
        startTimer();
        loadQuestion();
        startBtn.style.display = 'none';
        nextBtn.style.display = 'none';
    };

    function startTimer() {
        timerInterval = setInterval(() => {
            timeLeft--;
            const m = String(Math.floor(timeLeft / 60)).padStart(2, '0');
            const s = String(timeLeft % 60).padStart(2, '0');
            timeDisplay.textContent = `${m}:${s}`;
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                showResult();
            }
        }, 1000);
    }

    function loadQuestion() {
        const q = sessionQuestions[currentQuestion];
        quizEl.innerHTML = `
            <div style="font-size:20px; font-weight:bold; margin:20px 0;">
                Pregunta ${currentQuestion + 1} de 34
            </div>
            <div style="font-size:18px; margin:20px 0; line-height:1.5;">
                ${q.q}
            </div>
            ${q.opts.map(opt => `
                <div class="option" onclick="selectOption('${opt.replace(/'/g, "\\'")}')">${opt}</div>
            `).join('')}
        `;
        progressEl.style.width = ((currentQuestion + 1) / 34 * 100) + '%';
    }

    window.selectOption = (chosen) => {
        if (nextBtn.style.display === 'block') return;
        const q = sessionQuestions[currentQuestion];
        document.querySelectorAll('.option').forEach(div => {
            if (div.textContent === q.ans) div.classList.add('correct');
            if (div.textContent === chosen && chosen !== q.ans) div.classList.add('incorrect');
            div.style.pointerEvents = 'none';
        });
        if (chosen === q.ans) score++;
        nextBtn.style.display = 'block';
    };

    nextBtn.onclick = () => {
        currentQuestion++;
        if (currentQuestion >= 34) {
            showResult();
        } else {
            loadQuestion();
            nextBtn.style.display = 'none';
        }
    };

    function showResult() {
        clearInterval(timerInterval);
        quizEl.innerHTML = '';
        nextBtn.style.display = 'none';
        progressEl.style.width = '100%';
        const percent = Math.round((score / 34) * 100);

        // Guardar preguntas usadas
        sessionQuestions.forEach(q => {
            if (!usedQuestions.includes(q.originalIndex)) {
                usedQuestions.push(q.originalIndex);
            }
        });
        localStorage.setItem(`used_${user.uid}`, JSON.stringify(usedQuestions));
        usedCountEl.textContent = usedQuestions.length;

        // Guardar puntaje en Firestore
        addDoc(collection(db, "scores"), {
            userId: user.uid,
            userEmail: user.email,
            score: score,
            total: 34,
            percentage: percent,
            date: serverTimestamp()
        });

        resultEl.innerHTML = `
            <h2>¡Sesión completada!</h2>
            <p>Puntaje: <strong>${score} / 34</strong> (${percent}%)</p>
            ${percent >= 65 ? '<p style="color:green; font-size:22px;">¡Aprobado! (GED-like)</p>' : '<p style="color:#d32f2f;">Sigue practicando</p>'}
            <p>Preguntas completadas en total: <strong>${usedQuestions.length}/400</strong></p>
            <button class="resetBtn" onclick="location.reload()">Nueva sesión</button>
        `;
        resultEl.style.display = 'block';
    }
</script>
</body>
</html>


